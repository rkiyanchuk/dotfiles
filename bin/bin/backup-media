#!/usr/bin/env bash
# coding: utf-8

# Backup media data if RaspberryPi is reachable.

ICON_INFO="/usr/share/icons/gnome/256x256/status/dialog-information.png"
ICON_ERROR="/usr/share/icons/gnome/256x256/status/dialog-error.png"

USER='zoresvit'
RPI="192.168.1.102"

BACKUP_REMOTE_DIR="storage/sync/"
BACKUP_LOCAL_DIR="${HOME}/media/"
BACKUP_CMD="sudo -u ${USER} rsync -avz $BACKUP_LOCAL_DIR pi@${RPI}:${BACKUP_REMOTE_DIR}"


function popup() {
# param 1: message title.
# param 2: message content string for the popup.
# param 3: path to icon.
    export DISPLAY=:0.0 && \
        export XAUTHORITY=/home/${USER}/.Xauthority \
        && sudo -u ${USER} -- /usr/bin/notify-send "$1" "$2" -i "$3"
}

function is_alive() {
# param 1: host IP address string to check.
    ping -c 1 ${RPI} > /dev/null
    return $?
}


if is_alive ${RPI}; then
    popup "Media Backup" "Started." ${ICON_INFO}
    ${BACKUP_CMD}
    STATUS=$?
    if [[ ${STATUS} -eq 0 ]]; then
        popup "Media Backup" "Completed." ${ICON_INFO}
    else
        popup "Media Backup" "FAILED." ${ICON_ERROR}
    fi
else
    popup "Media Backup" "Attempted backup, but RPi is unreachable!" ${ICON_ERROR}
fi
